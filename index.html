<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Consumo Eléctrico Innova</title>
  <link rel="stylesheet" href="estilos.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @media screen and (max-width: 768px) {
      .main-flex {
        flex-direction: column;
        align-items: center;
      }
      .medidas.principal-box,
      .medidas.secundario-box {
        min-width: unset !important;
        max-width: 95% !important;
        width: 95%;
        margin-right: 0 !important;
      }
      #graficoConsumo {
        width: 95% !important;
        height: auto !important;
      }
      .form-row {
        flex-direction: column;
        align-items: flex-start;
      }
      .form-row input {
        width: 100%;
        margin-bottom: 8px;
      }
    }
  </style>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  
</head>
</head>

<body>
  <!-- Agrega esto justo DESPUÉS de la etiqueta <body> y ANTES de todo el contenido principal -->
<div id="pantallaLogin" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;background:#111c;backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;">
  <div style="background:#222;padding:38px 32px 28px 32px;border-radius:18px;box-shadow:0 8px 32px #ffe06655,0 4px 18px #66e0ff33;max-width:350px;width:95vw;text-align:center;">
    <h2 style="color:#66e0ff;margin-top:0;">Bienvenido</h2>
    <div id="loginForms">
      <div id="loginForm">
        <input type="email" id="loginEmail" placeholder="Correo" style="width:90%;margin-bottom:10px;padding:8px;border-radius:6px;border:1px solid #444;"><br>
        <input type="password" id="loginPassword" placeholder="Contraseña" style="width:90%;margin-bottom:14px;padding:8px;border-radius:6px;border:1px solid #444;"><br>
        <button onclick="iniciarSesion()" style="width:100%;margin-bottom:10px;">Iniciar sesión</button>
        <div style="margin-bottom:10px;">
          ¿No tienes cuenta? <a href="#" style="color:#ffe066;" onclick="mostrarRegistro(event)">Regístrate</a>
        </div>
      </div>
      <div id="registroForm" style="display:none;">
        <input type="text" id="registroNickname" placeholder="Tu apodo" style="width:90%;margin-bottom:10px;padding:8px;border-radius:6px;border:1px solid #444;"><br>
        <input type="email" id="registroEmail" placeholder="Correo" style="width:90%;margin-bottom:10px;padding:8px;border-radius:6px;border:1px solid #444;"><br>
        <input type="password" id="registroPassword" placeholder="Contraseña" style="width:90%;margin-bottom:14px;padding:8px;border-radius:6px;border:1px solid #444;"><br>
        <button onclick="registrar()" style="width:100%;margin-bottom:10px;">Registrarse</button>
        <div style="margin-bottom:10px;">
          ¿Ya tienes cuenta? <a href="#" style="color:#ffe066;" onclick="mostrarLogin(event)">Inicia sesión</a>
        </div>
        <div style="margin-bottom:10px; text-align:center;">
  <a href="#" style="color:#66e0ff; font-weight:bold;" onclick="entrarSinCuenta(event)">Entrar sin cuenta</a>
</div>
      </div>
    </div>
    <div id="loginMensaje" style="color:#ffe066;margin-top:10px;min-height:22px;"></div>
  </div>
</div>




<script>
function mostrarRegistro(e) {
  e.preventDefault();
  document.getElementById('loginForm').style.display = 'none';
  document.getElementById('registroForm').style.display = '';
}
function mostrarLogin(e) {
  e.preventDefault();
  document.getElementById('loginForm').style.display = '';
  document.getElementById('registroForm').style.display = 'none';
}
function entrarSinCuenta(e) {
  e.preventDefault();
  document.getElementById('pantallaLogin').style.display = 'none';
  document.getElementById('contenidoWeb').style.display = 'block';
  window.entrandoSinCuenta = true; // Bandera global
}

// Oculta la pantalla de login si el usuario está autenticado
function ocultarPantallaLogin() {
  document.getElementById('pantallaLogin').style.display = 'none';
  document.getElementById('contenidoWeb').style.display = 'block';
}

// Firebase auth hooks
window.registrar = function() {
  const email = document.getElementById("registroEmail").value;
  const password = document.getElementById("registroPassword").value;
  const nickname = document.getElementById("registroNickname").value;
  if (!email || !password || !nickname) {
    document.getElementById('loginMensaje').innerText = "Completa todos los campos.";
    return;
  }
  createUserWithEmailAndPassword(auth, email, password)
    .then((userCredential) => updateProfile(userCredential.user, { displayName: nickname }))
    .then(() => {
      document.getElementById('loginMensaje').innerText = "Cuenta creada con éxito. Inicia sesión.";
      setTimeout(ocultarPantallaLogin, 800);
    })
    .catch((error) => {
      document.getElementById('loginMensaje').innerText = "Error: " + error.message;
    });
};

window.iniciarSesion = function() {
  const email = document.getElementById("loginEmail").value;
  const password = document.getElementById("loginPassword").value;
  if (!email || !password) {
    document.getElementById('loginMensaje').innerText = "Completa todos los campos.";
    return;
  }
  signInWithEmailAndPassword(auth, email, password)
    .then(() => {
      document.getElementById('loginMensaje').innerText = "Sesión iniciada";
      setTimeout(ocultarPantallaLogin, 800);
    })
    .catch((error) => {
      document.getElementById('loginMensaje').innerText = "Error: " + error.message;
    });
};

// Oculta la pantalla si ya hay sesión iniciada
onAuthStateChanged(auth, (user) => {
  if (user) {
    ocultarPantallaLogin();
  } else {
    document.getElementById('pantallaLogin').style.display = 'flex';
    document.getElementById('contenidoWeb').style.display = 'none';
  }
});
</script>
<div id="contenidoWeb" style="display: none;"></div>

   <div style="width:100%;display:flex;justify-content:flex-end;align-items:center;margin-bottom:10px;">
  <a href="Presentacion/index.html" style="text-decoration:none;" target="_blank" rel="noopener">
    <button style="
      background: linear-gradient(90deg, #66e0ff 0%, #ffe066 100%);
      color: #222;
      font-weight: bold;
      font-size: 1.18em;
      border: none;
      border-radius: 30px;
      padding: 12px 38px;
      margin: 18px 32px 0 0;
      box-shadow: 0 4px 18px #ffe06655, 0 2px 8px #66e0ff33;
      transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
      cursor: pointer;
    "
    onmouseover="this.style.background='linear-gradient(90deg,#ffe066 0%,#66e0ff 100%)';this.style.transform='scale(1.06)';"
    onmouseout="this.style.background='linear-gradient(90deg,#66e0ff 0%,#ffe066 100%)';this.style.transform='scale(1)';"
    >
      <span style="vertical-align:middle;display:inline-block;margin-right:10px;">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;">
          <circle cx="12" cy="12" r="10" fill="#ffe066" stroke="#66e0ff"/>
          <path d="M8 12l3 3 5-5" stroke="#222" stroke-width="2.2" fill="none"/>
        </svg>
      </span>
      Presentación
    </button>
  </a>
</div>

    <div class="foco" id="focoContainer">
        <!-- SVG de foquito normal -->
        <svg id="focoNormal" width="120" height="180" viewBox="0 0 120 180">
            <ellipse cx="60" cy="175" rx="32" ry="8" fill="#000" opacity="0.18"/>
            <ellipse cx="60" cy="80" rx="44" ry="60" fill="url(#bulbGradient)" stroke="#ffe066" stroke-width="4"/>
            <ellipse cx="60" cy="60" rx="22" ry="18" fill="#fffbe0" opacity="0.35"/>
            <path d="M45 100 Q60 120 75 100" stroke="#ffb300" stroke-width="3" fill="none"/>
            <circle cx="60" cy="100" r="3.5" fill="#ffec80" stroke="#ffb300" stroke-width="1.5"/>
            <rect x="40" y="140" width="40" height="28" rx="10" fill="url(#baseGradient)" stroke="#888" stroke-width="3"/>
            <rect x="50" y="168" width="20" height="10" rx="3" fill="#888"/>
            <rect x="48" y="148" width="24" height="3" rx="1.5" fill="#ffe066" opacity="0.25"/>
            <rect x="48" y="155" width="24" height="3" rx="1.5" fill="#ffe066" opacity="0.18"/>
            <g opacity="0.18">
                <line x1="60" y1="10" x2="60" y2="30" stroke="#ffe066" stroke-width="5"/>
                <line x1="20" y1="40" x2="38" y2="60" stroke="#ffe066" stroke-width="4"/>
                <line x1="100" y1="40" x2="82" y2="60" stroke="#ffe066" stroke-width="4"/>
            </g>
            <defs>
                <radialGradient id="bulbGradient" cx="60" cy="80" r="60" gradientUnits="userSpaceOnUse">
                    <stop offset="0%" stop-color="#fffde4"/>
                    <stop offset="60%" stop-color="#ffe066"/>
                    <stop offset="100%" stop-color="#ffb300"/>
                </radialGradient>
                <linearGradient id="baseGradient" x1="40" y1="140" x2="80" y2="168" gradientUnits="userSpaceOnUse">
                    <stop offset="0%" stop-color="#bbb"/>
                    <stop offset="100%" stop-color="#888"/>
                </radialGradient>
            </defs>
        </svg>
        <!-- SVG de foquito roto partido en dos mitades -->
        <svg id="focoRotoIzq" class="foco-mitad izq" width="120" height="180" viewBox="0 0 120 180" style="display:none;">
            <ellipse cx="60" cy="175" rx="32" ry="8" fill="#000" opacity="0.18"/>
            <path d="M60 20 Q104 80 60 140 Q60 80 60 20 Z" fill="url(#bulbGradientBroken)" stroke="#ffe066" stroke-width="4"/>
            <path d="M60 20 Q104 80 60 140" stroke="#ffe066" stroke-width="4" fill="none"/>
            <path d="M60 80 L60 140" stroke="#bfa800" stroke-width="3" fill="none"/>
            <path d="M60 60 Q65 90 70 80 Q75 70 80 80" stroke="#bfa800" stroke-width="2" fill="none"/>
            <rect x="40" y="140" width="20" height="28" rx="10" fill="url(#baseGradient)" stroke="#888" stroke-width="3"/>
            <rect x="50" y="168" width="10" height="10" rx="3" fill="#888"/>
            <rect x="48" y="148" width="12" height="3" rx="1.5" fill="#ffe066" opacity="0.25"/>
            <rect x="48" y="155" width="12" height="3" rx="1.5" fill="#ffe066" opacity="0.18"/>
            <g opacity="0.10">
                <line x1="60" y1="10" x2="60" y2="30" stroke="#ffe066" stroke-width="5"/>
                <line x1="20" y1="40" x2="38" y2="60" stroke="#ffe066" stroke-width="4"/>
            </g>
            <defs>
                <radialGradient id="bulbGradientBroken" cx="60" cy="80" r="60" gradientUnits="userSpaceOnUse">
                    <stop offset="0%" stop-color="#fffde4"/>
                    <stop offset="60%" stop-color="#ffe066"/>
                    <stop offset="100%" stop-color="#bfa800"/>
                </radialGradient>
                <linearGradient id="baseGradient" x1="40" y1="140" x2="80" y2="168" gradientUnits="userSpaceOnUse">
                    <stop offset="0%" stop-color="#bbb"/>
                    <stop offset="100%" stop-color="#888"/>
                </linearGradient>
            </defs>
        </svg>
        <svg id="focoRotoDer" class="foco-mitad der" width="120" height="180" viewBox="0 0 120 180" style="display:none;">
            <ellipse cx="60" cy="175" rx="32" ry="8" fill="#000" opacity="0.18"/>
            <path d="M60 20 Q60 80 60 140 Q16 80 60 20 Z" fill="url(#bulbGradientBroken)" stroke="#ffe066" stroke-width="4"/>
            <path d="M60 20 Q16 80 60 140" stroke="#ffe066" stroke-width="4" fill="none"/>
            <path d="M60 80 L60 140" stroke="#bfa800" stroke-width="3" fill="none"/>
            <path d="M50 60 Q55 70 60 60 Q65 50 70 60" stroke="#bfa800" stroke-width="2" fill="none"/>
            <rect x="60" y="140" width="20" height="28" rx="10" fill="url(#baseGradient)" stroke="#888" stroke-width="3"/>
            <rect x="60" y="168" width="10" height="10" rx="3" fill="#888"/>
            <rect x="60" y="148" width="12" height="3" rx="1.5" fill="#ffe066" opacity="0.25"/>
            <rect x="60" y="155" width="12" height="3" rx="1.5" fill="#ffe066" opacity="0.18"/>
            <g opacity="0.10">
                <line x1="60" y1="10" x2="60" y2="30" stroke="#ffe066" stroke-width="5"/>
                <line x1="100" y1="40" x2="82" y2="60" stroke="#ffe066" stroke-width="4"/>
            </g>
            <defs>
                <radialGradient id="bulbGradientBroken" cx="60" cy="80" r="60" gradientUnits="userSpaceOnUse">
                    <stop offset="0%" stop-color="#fffde4"/>
                    <stop offset="60%" stop-color="#ffe066"/>
                    <stop offset="100%" stop-color="#bfa800"/>
                </radialGradient>
                <linearGradient id="baseGradient" x1="40" y1="140" x2="80" y2="168" gradientUnits="userSpaceOnUse">
                    <stop offset="0%" stop-color="#bbb"/>
                    <stop offset="100%" stop-color="#888"/>
                </linearGradient>
            </defs>
        </svg>
    </div>
    <div class="main-flex">
        <!-- Manual de uso -->
        <div class="medidas secundario-box" style="min-width:260px; max-width:320px; text-align:left; flex:1 1 0; background:#181818; border:2px solid #ffe066; box-shadow:0 4px 18px #ffe06633; margin-right:0;">
            <h3 style="margin-top:0; color:#ffe066;">Manual de uso</h3>
            <ol style="font-size:1.04em; padding-left:18px; margin-bottom: 18px;">
                <li><b>Calculadora de Consumo:</b><br>
                    Ingresa la cantidad y horas de uso diario de cada aparato. Haz clic en <b>Calcular</b> para ver el consumo y costo mensual estimado.
                </li>
                <li><b>Historial y Gráfico:</b><br>
                    Cada vez que calcules, se guarda el resultado en el historial y se agrega al gráfico. El eje X muestra los meses, el eje Y el consumo (kWh) y el costo (S/).
                </li>
                <li><b>Alertas y Foquito:</b><br>
                    Si el consumo sube respecto al mes anterior, verás alertas. Si sube mucho, el foquito se parte y cae animado.
                </li>
                <li><b>Borrar historial:</b><br>
                    Haz clic en el ícono de tachito para borrar todo el historial y el gráfico.
                </li>
                <li><b>Conversor de Watts a Soles:</b><br>
                    Ingresa los Watts y horas de uso al mes para saber cuánto costaría ese consumo.
                </li>
            </ol>
            <div style="font-size:0.98em; color:#ffe066; margin-top:10px;">¡Explora y aprende sobre el consumo eléctrico de tu escuela!</div>
        </div>
        <!-- Reemplaza tu div de la calculadora por este bloque -->
<div id="calculadoraBox" class="medidas principal-box" style="min-width:400px; flex:2 1 0; transition: max-height 0.4s, opacity 0.3s;">
  <div id="barraCalculadora" onclick="toggleCalculadora()" style="background:linear-gradient(90deg,#ffe066 60%,#fffbe0 100%);color:#222;font-weight:bold;cursor:pointer;padding:10px 0 10px 18px;border-radius:10px 10px 10px 10px;box-shadow:0 2px 8px #ffe06633;margin-bottom:12px;display:none;">
    <span style="font-size:1.15em;">Calculadora Escolar</span>
    <span style="float:right;font-size:1.3em;padding-right:18px;">&#9654;</span>
  </div>
  <div id="contenidoCalculadora">
    <h2>Calculadora de Consumo Eléctrico Escolar</h2>
    <form id="formulario">
      <div class="form-row">
        <label for="focos">Focos (10W c/u):</label>
        <input type="number" min="0" value="10" id="focos">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="8" id="horas_focos">
      </div>
      <div class="form-row">
        <label for="computadoras">Computadoras (100W c/u):</label>
        <input type="number" min="0" value="5" id="computadoras">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="6" id="horas_computadoras">
      </div>
      <div class="form-row">
        <label for="ventiladores">Ventiladores (60W c/u):</label>
        <input type="number" min="0" value="2" id="ventiladores">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="4" id="horas_ventiladores">
      </div>
      <div class="form-row">
        <label for="proyectores">Proyectores (200W c/u):</label>
        <input type="number" min="0" value="1" id="proyectores">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="2" id="horas_proyectores">
      </div>
      <div class="form-row">
        <label for="impresoras">Impresoras (50W c/u):</label>
        <input type="number" min="0" value="1" id="impresoras">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="1" id="horas_impresoras">
      </div>
      <div class="form-row">
        <label for="otros">Otros (Watts totales):</label>
        <input type="number" min="0" value="0" id="otros">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="0" id="horas_otros">
      </div>
      <button type="submit">Calcular</button>
    </form>
    <div style="text-align:right;margin-top:8px;">
      <button type="button" onclick="toggleCalculadora()" style="background:#ffe066;color:#222;font-weight:bold;border-radius:8px;padding:4px 18px;font-size:1em;box-shadow:0 2px 8px #ffe06633;border:none;cursor:pointer;">Ocultar</button>
    </div>
  </div>
</div>

<!-- Agrega este script al final de tu body o junto a tus otros scripts -->
<script>
function toggleCalculadora() {
  const box = document.getElementById('calculadoraBox');
  const barra = document.getElementById('barraCalculadora');
  const contenido = document.getElementById('contenidoCalculadora');
  if (contenido.style.display === 'none') {
    contenido.style.display = '';
    barra.style.display = 'none';
    box.style.maxHeight = '';
    box.style.opacity = '1';
  } else {
    contenido.style.display = 'none';
    barra.style.display = '';
    box.style.maxHeight = '60px';
    box.style.opacity = '0.95';
  }
}
// Inicializa minimizada en desktop si quieres:
// window.onload = () => { toggleCalculadora(); };
</script>
    <!-- Agrega esto justo debajo del bloque de la calculadora escolar -->
<div id="calculadoraDomesticaBox" class="medidas principal-box" style="min-width:400px; flex:2 1 0; transition: max-height 0.4s, opacity 0.3s; margin-top:18px;">
  <div id="barraCalculadoraDomestica" onclick="toggleCalculadoraDomestica()" style="background:linear-gradient(90deg,#66e0ff 60%,#fffbe0 100%);color:#222;font-weight:bold;cursor:pointer;padding:10px 0 10px 18px;border-radius:10px 10px 10px 10px;box-shadow:0 2px 8px #66e0ff33;margin-bottom:12px;">
    <span style="font-size:1.15em;">Calculadora Doméstica</span>
    <span style="float:right;font-size:1.3em;padding-right:18px;">&#9654;</span>
  </div>
  <div id="contenidoCalculadoraDomestica" style="display:none;">
    <h2>Calculadora de Consumo Doméstico</h2>
    <form id="formularioDomestico">
      <div class="form-row">
        <label for="refri">Refrigeradora (150W):</label>
        <input type="number" min="0" value="1" id="refri">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="24" id="horas_refri">
      </div>
      <div class="form-row">
        <label for="terma">Terma eléctrica (1200W):</label>
        <input type="number" min="0" value="1" id="terma">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="1" id="horas_terma">
      </div>
      <div class="form-row">
        <label for="lavadora">Lavadora (500W):</label>
        <input type="number" min="0" value="1" id="lavadora">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="0.5" id="horas_lavadora">
      </div>
      <div class="form-row">
        <label for="lavavajillas">Lavavajillas (1200W):</label>
        <input type="number" min="0" value="0" id="lavavajillas">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="0" id="horas_lavavajillas">
      </div>
      <div class="form-row">
        <label for="tele">Televisor (80W):</label>
        <input type="number" min="0" value="2" id="tele">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="4" id="horas_tele">
      </div>
      <div class="form-row">
        <label for="focos_dom">Focos (10W c/u):</label>
        <input type="number" min="0" value="8" id="focos_dom">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="6" id="horas_focos_dom">
      </div>
      <div class="form-row">
        <label for="calefactor">Calefactor (1500W):</label>
        <input type="number" min="0" value="0" id="calefactor">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="0" id="horas_calefactor">
      </div>
      <div class="form-row">
        <label for="computadoras_dom">Computadoras (100W c/u):</label>
        <input type="number" min="0" value="2" id="computadoras_dom">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="5" id="horas_computadoras_dom">
      </div>
      <div class="form-row">
        <label for="impresoras_dom">Impresoras (50W c/u):</label>
        <input type="number" min="0" value="1" id="impresoras_dom">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="1" id="horas_impresoras_dom">
      </div>
      <div class="form-row">
        <label for="cargadores">Cargadores (10W c/u):</label>
        <input type="number" min="0" value="4" id="cargadores">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="3" id="horas_cargadores">
      </div>
      <div class="form-row">
        <label for="modem">Módem de internet (12W):</label>
        <input type="number" min="0" value="1" id="modem">
        <span>Horas/día:</span>
        <input class="horas-input" type="number" min="0" max="24" value="24" id="horas_modem">
      </div>
      <button type="submit">Calcular</button>
    </form>
    <div style="text-align:right;margin-top:8px;">
      <button type="button" onclick="toggleCalculadoraDomestica()" style="background:#66e0ff;color:#222;font-weight:bold;border-radius:8px;padding:4px 18px;font-size:1em;box-shadow:0 2px 8px #66e0ff33;border:none;cursor:pointer;">Ocultar</button>
    </div>
    <div class="resultado" id="resultadoDomestico"></div>
  </div>
</div>



<script>
// --- Lógica de alternancia y borrado de historial ---
let historialDomestico = [];
let historialEscolar = [];

function toggleCalculadora() {
  const box = document.getElementById('calculadoraBox');
  const barra = document.getElementById('barraCalculadora');
  const contenido = document.getElementById('contenidoCalculadora');
  const domBox = document.getElementById('calculadoraDomesticaBox');
  const domBarra = document.getElementById('barraCalculadoraDomestica');
  const domContenido = document.getElementById('contenidoCalculadoraDomestica');

  // Si la doméstica está abierta, ciérrala y borra su historial
  if (domContenido && domContenido.style.display !== 'none') {
    domContenido.style.display = 'none';
    domBarra.style.display = '';
    domBox.style.maxHeight = '60px';
    domBox.style.opacity = '0.95';
    localStorage.removeItem('historialDomestico');
    document.getElementById('resultadoDomestico').innerHTML = '';
  }

  if (contenido.style.display === 'none') {
    contenido.style.display = '';
    barra.style.display = 'none';
    box.style.maxHeight = '';
    box.style.opacity = '1';
    // Recuperar historial escolar
    let historial = JSON.parse(localStorage.getItem('historialConsumo')) || [];
    mostrarHistorial(historial);
  } else {
    contenido.style.display = 'none';
    barra.style.display = '';
    box.style.maxHeight = '60px';
    box.style.opacity = '0.95';
    // Borrar historial escolar
    localStorage.removeItem('historialConsumo');
    mostrarHistorial([]);
  }
}

function toggleCalculadoraDomestica() {
  const box = document.getElementById('calculadoraDomesticaBox');
  const barra = document.getElementById('barraCalculadoraDomestica');
  const contenido = document.getElementById('contenidoCalculadoraDomestica');
  const escBox = document.getElementById('calculadoraBox');
  const escBarra = document.getElementById('barraCalculadora');
  const escContenido = document.getElementById('contenidoCalculadora');

  // Si la escolar está abierta, ciérrala y borra su historial
  if (escContenido && escContenido.style.display !== 'none') {
    escContenido.style.display = 'none';
    escBarra.style.display = '';
    escBox.style.maxHeight = '60px';
    escBox.style.opacity = '0.95';
    localStorage.removeItem('historialConsumo');
    mostrarHistorial([]);
  }

  if (contenido.style.display === 'none') {
    contenido.style.display = '';
    barra.style.display = 'none';
    box.style.maxHeight = '';
    box.style.opacity = '1';
    // Recuperar historial doméstico
    mostrarHistorialDomestico();
  } else {
    contenido.style.display = 'none';
    barra.style.display = '';
    box.style.maxHeight = '60px';
    box.style.opacity = '0.95';
    // Borrar historial doméstico
    localStorage.removeItem('historialDomestico');
    document.getElementById('resultadoDomestico').innerHTML = '';
  }
}

// --- Lógica de la calculadora doméstica ---
document.getElementById('formularioDomestico').addEventListener('submit', function(e) {
  e.preventDefault();
  const DIAS_MES = 30;
  const PRECIO_KWH = 0.6589;

  const refri = parseInt(document.getElementById('refri').value) || 0;
  const horas_refri = parseFloat(document.getElementById('horas_refri').value) || 0;
  const terma = parseInt(document.getElementById('terma').value) || 0;
  const horas_terma = parseFloat(document.getElementById('horas_terma').value) || 0;
  const lavadora = parseInt(document.getElementById('lavadora').value) || 0;
  const horas_lavadora = parseFloat(document.getElementById('horas_lavadora').value) || 0;
  const lavavajillas = parseInt(document.getElementById('lavavajillas').value) || 0;
  const horas_lavavajillas = parseFloat(document.getElementById('horas_lavavajillas').value) || 0;
  const tele = parseInt(document.getElementById('tele').value) || 0;
  const horas_tele = parseFloat(document.getElementById('horas_tele').value) || 0;
  const focos = parseInt(document.getElementById('focos_dom').value) || 0;
  const horas_focos = parseFloat(document.getElementById('horas_focos_dom').value) || 0;
  const calefactor = parseInt(document.getElementById('calefactor').value) || 0;
  const horas_calefactor = parseFloat(document.getElementById('horas_calefactor').value) || 0;
  const computadoras = parseInt(document.getElementById('computadoras_dom').value) || 0;
  const horas_computadoras = parseFloat(document.getElementById('horas_computadoras_dom').value) || 0;
  const impresoras = parseInt(document.getElementById('impresoras_dom').value) || 0;
  const horas_impresoras = parseFloat(document.getElementById('horas_impresoras_dom').value) || 0;
  const cargadores = parseInt(document.getElementById('cargadores').value) || 0;
  const horas_cargadores = parseFloat(document.getElementById('horas_cargadores').value) || 0;
  const modem = parseInt(document.getElementById('modem').value) || 0;
  const horas_modem = parseFloat(document.getElementById('horas_modem').value) || 0;

  // Consumos
  const consumoRefri = refri * 150 * horas_refri * DIAS_MES / 1000;
  const consumoTerma = terma * 1200 * horas_terma * DIAS_MES / 1000;
  const consumoLavadora = lavadora * 500 * horas_lavadora * DIAS_MES / 1000;
  const consumoLavavajillas = lavavajillas * 1200 * horas_lavavajillas * DIAS_MES / 1000;
  const consumoTele = tele * 80 * horas_tele * DIAS_MES / 1000;
  const consumoFocos = focos * 10 * horas_focos * DIAS_MES / 1000;
  const consumoCalefactor = calefactor * 1500 * horas_calefactor * DIAS_MES / 1000;
  const consumoComputadoras = computadoras * 100 * horas_computadoras * DIAS_MES / 1000;
  const consumoImpresoras = impresoras * 50 * horas_impresoras * DIAS_MES / 1000;
  const consumoCargadores = cargadores * 10 * horas_cargadores * DIAS_MES / 1000;
  const consumoModem = modem * 12 * horas_modem * DIAS_MES / 1000;

  const consumoTotal = consumoRefri + consumoTerma + consumoLavadora + consumoLavavajillas + consumoTele + consumoFocos + consumoCalefactor + consumoComputadoras + consumoImpresoras + consumoCargadores + consumoModem;
  const costoTotal = consumoTotal * PRECIO_KWH;

  // Guardar historial doméstico
  let historial = JSON.parse(localStorage.getItem('historialDomestico')) || [];
  historial.push({
    fecha: new Date().toLocaleDateString(),
    kwh: consumoTotal.toFixed(2),
    costo: costoTotal.toFixed(2)
  });
  localStorage.setItem('historialDomestico', JSON.stringify(historial));

  mostrarHistorialDomestico();

  document.getElementById('resultadoDomestico').innerHTML = `
    <strong>Consumo mensual estimado:</strong> ${consumoTotal.toFixed(2)} kWh<br>
    <strong>Costo mensual estimado:</strong> S/ ${costoTotal.toFixed(2)}<br><br>
    <table style="margin:0 auto; background:#181818; color:#66e0ff; border-radius:8px; font-size:1.05em;">
      <tr><th style='color:#fff;'>Aparato</th><th style='color:#fff;'>Consumo (kWh)</th><th style='color:#fff;'>Costo (S/)</th></tr>
      <tr><td>Refrigeradora</td><td>${consumoRefri.toFixed(2)}</td><td>${(consumoRefri*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Terma eléctrica</td><td>${consumoTerma.toFixed(2)}</td><td>${(consumoTerma*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Lavadora</td><td>${consumoLavadora.toFixed(2)}</td><td>${(consumoLavadora*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Lavavajillas</td><td>${consumoLavavajillas.toFixed(2)}</td><td>${(consumoLavavajillas*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Televisor</td><td>${consumoTele.toFixed(2)}</td><td>${(consumoTele*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Focos</td><td>${consumoFocos.toFixed(2)}</td><td>${(consumoFocos*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Calefactor</td><td>${consumoCalefactor.toFixed(2)}</td><td>${(consumoCalefactor*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Computadoras</td><td>${consumoComputadoras.toFixed(2)}</td><td>${(consumoComputadoras*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Impresoras</td><td>${consumoImpresoras.toFixed(2)}</td><td>${(consumoImpresoras*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Cargadores</td><td>${consumoCargadores.toFixed(2)}</td><td>${(consumoCargadores*PRECIO_KWH).toFixed(2)}</td></tr>
      <tr><td>Módem</td><td>${consumoModem.toFixed(2)}</td><td>${(consumoModem*PRECIO_KWH).toFixed(2)}</td></tr>
    </table>
  `;
});

function mostrarHistorialDomestico() {
  let historial = JSON.parse(localStorage.getItem('historialDomestico')) || [];
  let html = "<h3>Historial de Consumo Doméstico</h3><table style='width:100%;color:#66e0ff;text-align:center'><tr><th>Fecha</th><th>Consumo (kWh)</th><th>Costo (S/)</th></tr>";
  historial.forEach(item => {
    html += `<tr><td>${item.fecha}</td><td>${item.kwh}</td><td>${item.costo}</td></tr>`;
  });
  html += "</table>";
  document.getElementById('resultadoDomestico').innerHTML = html;
}
</script>
        <div class="medidas secundario-box" style="min-width:260px; max-width:320px; text-align:left; flex:1 1 0;">
            <h3 style="margin-top:0; color:#ffe066;">¿Cómo se calcula el consumo?</h3>
            <ol style="font-size:1.04em; padding-left:18px; margin-bottom: 18px;">
                <li>Para cada aparato: <br><b style="color:#ffe066;">Cantidad × Potencia (W) × Horas/día × Días/mes</b></li>
                <li>Se suman todos los consumos y se divide entre 1000 para pasar de Wh a <b style="color:#ffe066;">kWh</b>.</li>
                <li>El costo mensual es: <b style="color:#ffe066;">Consumo total (kWh) × Precio por kWh</b></li>
                <li>En este sistema: <b style="color:#ffe066;">Precio por kWh = S/ 0.6589</b> y <b style="color:#ffe066;">Días/mes = 30</b></li>
            </ol>
            <hr style="border:0;border-top:1px solid #444; margin: 18px 0 14px 0;">
            <h3 style="color:#ffe066;">Conversor de Watts a Soles</h3>
            <div class="conversor-box">
                <div style="margin-bottom:8px;">Ingresa Watts y horas de uso al mes:</div>
                <label>Watts: <input type="number" id="conv_watts" min="0" value="100"></label>
                <label>Horas/mes: <input type="number" id="conv_horas" min="0" value="22"></label>
                <button id="btnConvertir">Convertir</button>
                <div id="conv_resultado"></div>
            </div>
        </div>
        <div class="medidas principal-box" style="min-width:400px; max-width:520px; text-align:center; display:flex; flex-direction:column; align-items:center; flex:2 1 0;">
            <h3 style="color:#ffe066; margin-top:0;">Histórico Gráfico</h3>
            <canvas id="graficoConsumo" width="340" height="220" style="background:#181818; border-radius:10px; box-shadow:0 2px 8px #ffe06622; margin-bottom:10px;"></canvas>
            <div style="font-size:0.95em; color:#ffe066;">Eje X: Meses &nbsp;|&nbsp; Eje Y: kWh y S/</div>
        </div>
    </div>
    <div class="resultado" id="resultado"></div>
    <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
        <div id="historial" class="medidas" style="margin-bottom: 0;"></div>
        <button id="borrarHistorial" title="Borrar historial" style="background: none; border: none; cursor: pointer; margin-bottom: 20px;">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="6" width="18" height="14" rx="2" fill="#333" stroke="#fff"/>
                <line x1="9" y1="10" x2="9" y2="16" />
                <line x1="12" y1="10" x2="12" y2="16" />
                <line x1="15" y1="10" x2="15" y2="16" />
                <rect x="8" y="2" width="8" height="4" rx="1" fill="#333" stroke="#fff"/>
            </svg>
        </button>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="script.js"></script>

<div id="comentariosFalsos" class="medidas principal-box" style="max-width:520px; margin: 32px auto 0 auto; text-align:left;">
  <h3 style="color:#66e0ff; margin-top:0;">Comentarios de usuarios</h3>

  <!-- Comentarios falsos -->
  <div style="margin-bottom:18px;">
    <b>María G.</b> <span style="color:#ffe066;">★★★★★</span><br>
    <i>¡Me encantó la calculadora! Ahora sé exactamente cuánto gasto en electricidad cada mes. Súper útil y fácil de usar.</i>
  </div>
  <div style="margin-bottom:18px;">
    <b>Carlos P.</b> <span style="color:#ffe066;">★★★★★</span><br>
    <i>El gráfico es muy visual y me ayuda a comparar el consumo de cada mes. ¡Excelente herramienta para ahorrar energía!</i>
  </div>
  <div style="margin-bottom:18px;">
    <b>Ana L.</b> <span style="color:#ffe066;">★★★★★</span><br>
    <i>La animación del foquito roto es genial, me motiva a no gastar de más. ¡Muy educativa y divertida!</i>
  </div>
  <div style="margin-bottom:18px;">
    <b>Profesor Luis</b> <span style="color:#ffe066;">★★★★★</span><br>
    <i>El diseño es moderno y funciona perfecto en mi celular. ¡Recomiendo esta página a todos los colegios!</i>
  </div>
  <div style="margin-bottom:18px;">
    <b>Gerard</b> <span style="color:#ffe066;">★★★★★</span><br>
    <i>Una muy buena pagina innovadora y segura ,gracias a la pagina pude calcular mi consumo y darme cuenta que debo ahorrar y disminuir el mal uso de energía eléctrica</i>
  </div>

  <!-- Comentarios del usuario -->
  <div id="comentariosReales"></div>

  <!-- Formulario para agregar comentario -->
  <h4 style="margin-top:25px;">Escribe tu comentario</h4>
  <textarea id="comentarioInput" placeholder="Tu opinión..." style="width:100%; height:60px; margin-bottom:10px;"></textarea>
  <div style="margin-bottom:10px;">
    Calificación:
    <span id="estrellas"></span>
  </div>
  <button onclick="guardarComentario()" style="padding:6px 12px; background:#66e0ff; color:white; border:none; border-radius:5px;">Enviar</button>
</div>
<!-- Mostrar nombre arriba -->
<div id="nombreUsuario"></div>


<script>
  let calificacionSeleccionada = 5;

  const estrellas = document.getElementById("estrellas");
  estrellas.innerHTML = [...Array(5)].map((_, i) =>
    `<span style="cursor:pointer; font-size:20px;" onclick="seleccionarEstrellas(${i + 1})" id="estrella${i + 1}">★</span>`
  ).join('');

  function seleccionarEstrellas(n) {
    calificacionSeleccionada = n;
    for (let i = 1; i <= 5; i++) {
      document.getElementById(`estrella${i}`).style.color = i <= n ? "#ffe066" : "#ccc";
    }
  }

  function guardarComentario() {
  // Si el usuario entró sin cuenta, no puede comentar
  if (window.entrandoSinCuenta) {
    alert("Debes iniciar sesión o registrarte para comentar.");
    return;
  }

  const texto = document.getElementById("comentarioInput").value.trim();
  if (texto === "") return;

  const nuevo = {
    texto: texto,
    estrellas: calificacionSeleccionada
  };

  let comentarios = JSON.parse(localStorage.getItem("comentariosUsuario")) || [];
  comentarios.push(nuevo);
  localStorage.setItem("comentariosUsuario", JSON.stringify(comentarios));

  document.getElementById("comentarioInput").value = "";
  seleccionarEstrellas(5);
  mostrarComentarios();
}
  function mostrarComentarios() {
    const contenedor = document.getElementById("comentariosReales");
    contenedor.innerHTML = "";
    const comentarios = JSON.parse(localStorage.getItem("comentariosUsuario")) || [];

    comentarios.forEach(com => {
      const div = document.createElement("div");
      div.style.marginBottom = "18px";
      div.innerHTML = `<b>Tú</b> <span style="color:#ffe066;">${"★".repeat(com.estrellas)}${"☆".repeat(5 - com.estrellas)}</span><br><i>${com.texto}</i>`;
      contenedor.appendChild(div);
    });
  }

  window.onload = () => {
    seleccionarEstrellas(5);
    mostrarComentarios();
  };
</script>
<div class="iconos-sociales">
  <a href="https://mail.google.com/mail/u/0/#inbox/FMfcgzQbfxbzBdLLrWLhgmKhxWFpFrpq?compose=CllgCJZbhvHwQkgcmwGVqqdbCBRZdngZzcQZwjkQXhWlvdQVgbGwCvfBScCFWDvkCPLWGpvqNnB" target="_blank" title="Enviar correo">
    <img src="https://cdn-icons-png.flaticon.com/512/281/281769.png" alt="Gmail" class="icono-social">
  </a>
  <a href="https://github.com/Ignaciocr10" target="_blank" title="Mi perfil en GitHub">
    <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/github.svg" alt="GitHub" class="icono-social github-icon">
  </a>
</div>

    
</div>
</div>
</body>
</html>
